#ifndef BLE_H
#define BLE_H

#include <esp_err.h>
#include <esp_gatt_defs.h>
#include <esp_bt_defs.h>

#define APP_ID 0x6969

// Vibration service UUIDs
#define VIBRATOR_SERVICE_UUID   {0x69, 0x00, 0x00, 0x00, 0x42, 0x00, 0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0, 0x00, 0x00}
#define VIBRATOR_CTRL_UUID      {0x69, 0x00, 0x00, 0x00, 0x42, 0x00, 0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0, 0x00, 0x01}

// Wi-Fi service UUIDs
#define WIFI_SERVICE_UUID       {0x69, 0x00, 0x00, 0x00, 0x42, 0x00, 0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0, 0x01, 0x00}
#define WIFI_SSID_UUID          {0x69, 0x00, 0x00, 0x00, 0x42, 0x00, 0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0, 0x01, 0x01}
#define WIFI_USERNAME_UUID      {0x69, 0x00, 0x00, 0x00, 0x42, 0x00, 0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0, 0x01, 0x02}
#define WIFI_IDENTITY_UUID      {0x69, 0x00, 0x00, 0x00, 0x42, 0x00, 0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0, 0x01, 0x03}
#define WIFI_PASSWORD_UUID      {0x69, 0x00, 0x00, 0x00, 0x42, 0x00, 0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0, 0x01, 0x04}
#define WIFI_CONNECT_UUID       {0x69, 0x00, 0x00, 0x00, 0x42, 0x00, 0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC, 0xDE, 0xF0, 0x01, 0x05}

#define BLE_NUM_SERVICES 2
#define BLE_NUM_VIBRATOR_CHARACTERISTICS 1
#define BLE_NUM_WIFI_CHARACTERISTICS 6

#define SERVICE_ID(UUID, IS_PRIMARY) {\
        .id = {\
            .inst_id = 0,\
            .uuid = {\
                .len = ESP_UUID_LEN_128,\
                .uuid = {\
                    .uuid128 = UUID\
                }\
            }\
        },\
        .is_primary = IS_PRIMARY\
    }

#define CHARACTERISTIC_UUID(UUID) {\
        .len = ESP_UUID_LEN_128,\
        .uuid = { \
            .uuid128 = UUID\
        }\
    }

typedef esp_err_t (*ble_chrc_write_cb)(void);
typedef esp_err_t (*ble_chrc_read_cb)(void);

struct ble_characteristic {
    uint16_t handle;
    uint8_t *value;
    uint32_t value_len;
    ble_chrc_write_cb write_cb;
    ble_chrc_read_cb read_cb;
};

struct ble_service {
    uint16_t handle;
    struct ble_characteristic *characteristics;
    uint32_t characteristics_len;
};

esp_err_t ble_init(void);
esp_err_t ble_disable(void);

#endif